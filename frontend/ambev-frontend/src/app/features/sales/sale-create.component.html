<div class="container py-4">
  <div class="row mb-3">
    <div class="col-12">
      <h2 class="mb-0">Nova Venda</h2>
    </div>
  </div>
  <div class="card shadow-sm">
    <div class="card-body">
      <form (ngSubmit)="saveSale()" #saleForm="ngForm">
        <div class="mb-3">
          <label for="userId" class="form-label">Usuário</label>
          <select id="userId" class="form-select" [(ngModel)]="sale.userId" name="userId" required>
            <option value="" disabled selected>Selecione o usuário</option>
            <option *ngFor="let user of users" [value]="user.id">{{ user.name?.firstname }} {{ user.name?.lastname }}</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="branch" class="form-label">Filial</label>
          <input type="text" id="branch" class="form-control" [(ngModel)]="sale.branch" name="branch" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Produtos</label>
          <div *ngFor="let item of sale.items ?? []; let i = index" class="d-flex mb-2 align-items-center">
            <select class="form-select me-2" [(ngModel)]="item.productId" name="productId{{i}}" required>
              <option value="" disabled selected>Selecione o produto</option>
              <option *ngFor="let product of products" [value]="product.id">{{ product.title }}</option>
            </select>
            <label class="me-2 mb-0">Quantidade</label>
            <input type="number" class="form-control me-2" [(ngModel)]="item.quantity" name="quantity{{i}}" placeholder="Quantidade" required>
            <label class="me-2 mb-0">Preço</label>
            <input type="number" class="form-control me-2" [(ngModel)]="item.price" name="price{{i}}" placeholder="Preço" required>
            <label class="me-2 mb-0">Cancelar</label>
            <input type="checkbox" class="form-check-input me-2" [(ngModel)]="item.cancelled" name="cancelled{{i}}">
            <button type="button" class="btn btn-warning btn-sm ms-2" (click)="editItem(sale.id || '', item.productId || '')">Editar</button>
          </div>
        </div>
        <div *ngIf="errors.length" class="alert alert-danger">
            <ul class="mb-0">
            <li *ngFor="let error of errors">{{ error }}</li>
            </ul>
        </div>
      </form>
    </div>
  </div>
</div>
