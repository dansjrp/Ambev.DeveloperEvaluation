<div class="container py-4">
  <div class="row mb-3">
    <div class="col-12">
  <h2 class="mb-0">{{ isEdit ? 'Editar Carrinho' : 'Novo Carrinho' }}</h2>
    </div>
  </div>
  <div class="card shadow-sm">
    <div class="card-body">
      <form (ngSubmit)="saveCart()" #cartForm="ngForm">
        <div class="mb-3">
          <label for="userId" class="form-label">Usuário</label>
          <select id="userId" class="form-select" [(ngModel)]="cart.userId" name="userId" required>
            <option value="" disabled selected>Selecione o usuário</option>
            <option *ngFor="let user of users" [value]="user.id">{{ user.name?.firstname }} {{ user.name?.lastname }}</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Produtos</label>
          <div *ngFor="let item of cart.products ?? []; let i = index" class="d-flex mb-2 align-items-center">
            <select class="form-select me-2" [(ngModel)]="item.productId" name="productId{{i}}" required>
              <option value="" disabled selected>Selecione o produto</option>
              <option *ngFor="let product of products" [value]="product.id">{{ product.title }}</option>
            </select>
            <input type="number" class="form-control me-2" [(ngModel)]="item.quantity" name="quantity{{i}}" placeholder="Quantidade" required>
            <button type="button" class="btn btn-danger btn-sm" (click)="cart.products && cart.products.splice(i, 1)">Remover</button>
          </div>
          <button type="button" class="btn btn-secondary btn-sm" (click)="cart.products && cart.products.push({ productId: '', quantity: 1 })">Adicionar Produto</button>
        </div>
        <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
        <button type="submit" class="btn btn-primary" [disabled]="loading">Salvar</button>
      </form>
    </div>
  </div>
</div>
